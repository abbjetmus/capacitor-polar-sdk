{"version":3,"file":"polar-protobuf.js","sourceRoot":"","sources":["../../src/polar-protobuf.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Polar Protocol Buffer Definitions for Web Bluetooth\n * Based on native Polar SDK protobuf schemas\n */\n\nimport protobuf from 'protobufjs';\n\n// PFTP Protocol Definitions\nconst pftpProto = `\nsyntax = \"proto2\";\n\npackage PftpRequest;\n\nmessage PbPFtpOperation {\n  enum Command {\n    GET = 0;\n    PUT = 1;\n  }\n  required Command command = 1;\n  required string path = 2;\n}\n\nmessage PbPFtpError {\n  required uint32 error = 1;\n}\n\nmessage PbDate {\n  required uint32 year = 1;\n  required uint32 month = 2;\n  required uint32 day = 3;\n}\n\nmessage PbTime {\n  required uint32 hour = 1;\n  required uint32 minute = 2;\n  required uint32 seconds = 3;\n  optional uint32 millis = 4;\n}\n\nmessage PbPFtpSetLocalTimeParams {\n  required PbDate date = 1;\n  required PbTime time = 2;\n  optional int32 tz_offset = 3;\n}\n`;\n\n// User Identifier Protocol Definition\nconst userIdSchema = {\n    nested: {\n        UserData: {\n            nested: {\n                PbDate: {\n                    fields: {\n                        year: { type: 'uint32', id: 1, rule: 'required' },\n                        month: { type: 'uint32', id: 2, rule: 'required' },\n                        day: { type: 'uint32', id: 3, rule: 'required' }\n                    }\n                },\n                PbTime: {\n                    fields: {\n                        hour: { type: 'uint32', id: 1, rule: 'required' },\n                        minute: { type: 'uint32', id: 2, rule: 'required' },\n                        second: { type: 'uint32', id: 3, rule: 'required' },\n                        millis: { type: 'uint32', id: 4, rule: 'optional' },\n                        tz_offset: { type: 'int32', id: 5, rule: 'optional' }\n                    }\n                },\n                PbSystemDateTime: {\n                    fields: {\n                        date: { type: 'PbDate', id: 1, rule: 'required' },\n                        time: { type: 'PbTime', id: 2, rule: 'required' },\n                        trusted: { type: 'bool', id: 3, rule: 'required' }\n                    }\n                },\n                PbUserIdentifier: {\n                    fields: {\n                        master_identifier: { type: 'uint64', id: 1, rule: 'required' },\n                        user_id_last_modified: { type: 'PbSystemDateTime', id: 100, rule: 'optional' }\n                    }\n                }\n            }\n        }\n    }\n};\n\n// FTU Config Protocol Definitions using JSON (more reliable)\nconst ftuSchema = {\n    nested: {\n        PolarUserData: {\n            nested: {\n                PbDate: {\n                    fields: {\n                        year: { type: 'uint32', id: 1, rule: 'required' },\n                        month: { type: 'uint32', id: 2, rule: 'required' },\n                        day: { type: 'uint32', id: 3, rule: 'required' }\n                    }\n                },\n                PbTime: {\n                    fields: {\n                        hour: { type: 'uint32', id: 1, rule: 'required' },\n                        minute: { type: 'uint32', id: 2, rule: 'required' },\n                        second: { type: 'uint32', id: 3, rule: 'required' },\n                        millis: { type: 'uint32', id: 4, rule: 'optional' },\n                        tz_offset: { type: 'int32', id: 5, rule: 'optional' }\n                    }\n                },\n                PbSystemDateTime: {\n                    fields: {\n                        date: { type: 'PbDate', id: 1, rule: 'required' },\n                        time: { type: 'PbTime', id: 2, rule: 'required' },\n                        trusted: { type: 'bool', id: 3, rule: 'required' }\n                    }\n                },\n                PbGender: {\n                    values: {\n                        MALE: 0,\n                        FEMALE: 1\n                    }\n                },\n                PbTypicalDay: {\n                    values: {\n                        MOSTLY_SITTING: 1,\n                        MOSTLY_STANDING: 2,\n                        MOSTLY_MOVING: 3\n                    }\n                },\n                PbUserPhysData: {\n                    fields: {\n                        gender: { type: 'PbGender', id: 1, rule: 'required' },\n                        birthDate: { type: 'PbDate', id: 2, rule: 'required' },\n                        weight: { type: 'float', id: 3, rule: 'required' },\n                        height: { type: 'float', id: 4, rule: 'required' },\n                        maxHeartRate: { type: 'uint32', id: 5, rule: 'required' },\n                        vo2Max: { type: 'uint32', id: 6, rule: 'required' },\n                        restingHeartRate: { type: 'uint32', id: 7, rule: 'required' },\n                        trainingBackground: { type: 'uint32', id: 8, rule: 'required' },\n                        typicalDay: { type: 'PbTypicalDay', id: 9, rule: 'required' },\n                        sleepGoal: { type: 'uint32', id: 10, rule: 'required' },\n                        lastModified: { type: 'PbSystemDateTime', id: 11, rule: 'required' }\n                    }\n                }\n            }\n        }\n    }\n};\n\n// Create root\nlet pftpRoot: protobuf.Root;\nlet ftuRoot: protobuf.Root;\nlet userIdRoot: protobuf.Root;\n\nexport const initProtobuf = (): void => {\n    try {\n        pftpRoot = protobuf.parse(pftpProto).root;\n        ftuRoot = protobuf.Root.fromJSON(ftuSchema);\n        userIdRoot = protobuf.Root.fromJSON(userIdSchema);\n        console.log('Protocol Buffers initialized successfully');\n\n        // Debug: Log what types were created\n        const physData = ftuRoot.lookupType('PolarUserData.PbUserPhysData');\n        console.log('FTU protobuf type created:', physData);\n        console.log('Available fields:', Object.keys(physData.fields));\n    } catch (error) {\n        console.error('Failed to initialize protobuf:', error);\n        throw error;\n    }\n};\n\nexport const createPftpOperation = (command: 'GET' | 'PUT', path: string): Uint8Array => {\n    if (!pftpRoot) initProtobuf();\n\n    const PbPFtpOperation = pftpRoot.lookupType('PftpRequest.PbPFtpOperation');\n\n    const message = PbPFtpOperation.create({\n        command: command === 'GET' ? 0 : 1,\n        path: path\n    });\n\n    return PbPFtpOperation.encode(message).finish();\n};\n\nexport interface FtuConfig {\n    gender: 'MALE' | 'FEMALE';\n    birthDate: string; // ISO format YYYY-MM-DD\n    height: number;\n    weight: number;\n    maxHeartRate: number;\n    vo2Max: number;\n    restingHeartRate: number;\n    trainingBackground: number;\n    deviceTime: string; // ISO datetime\n    typicalDay: number; // 1-3\n    sleepGoalMinutes: number;\n}\n\nexport const encodeFtuConfig = (config: FtuConfig): Uint8Array => {\n    if (!ftuRoot) initProtobuf();\n\n    const PbUserPhysData = ftuRoot.lookupType('PolarUserData.PbUserPhysData');\n\n    console.log('Protobuf type fields:', PbUserPhysData.fields);\n    console.log('Input config:', config);\n\n    // Parse birth date\n    const birthDate = new Date(config.birthDate);\n    console.log('Birth date parsed:', birthDate);\n\n    // Parse device time\n    const deviceTime = new Date(config.deviceTime);\n    const tzOffset = -deviceTime.getTimezoneOffset(); // Convert to minutes\n    console.log('Device time parsed:', deviceTime, 'TZ offset:', tzOffset);\n\n    const messageData = {\n        gender: config.gender === 'MALE' ? 0 : 1,\n        birthDate: {\n            year: birthDate.getFullYear(),\n            month: birthDate.getMonth() + 1,\n            day: birthDate.getDate()\n        },\n        weight: config.weight,\n        height: config.height,\n        maxHeartRate: config.maxHeartRate,\n        vo2Max: config.vo2Max,\n        restingHeartRate: config.restingHeartRate,\n        trainingBackground: config.trainingBackground,\n        typicalDay: config.typicalDay,\n        sleepGoal: config.sleepGoalMinutes,\n        lastModified: {\n            date: {\n                year: deviceTime.getFullYear(),\n                month: deviceTime.getMonth() + 1,\n                day: deviceTime.getDate()\n            },\n            time: {\n                hour: deviceTime.getHours(),\n                minute: deviceTime.getMinutes(),\n                second: deviceTime.getSeconds(),\n                millis: deviceTime.getMilliseconds(),\n                tz_offset: tzOffset\n            },\n            trusted: true\n        }\n    };\n\n    console.log('Creating protobuf message with data:', messageData);\n\n    const message = PbUserPhysData.create(messageData);\n    console.log('Message created:', message);\n    console.log('Message fields:', JSON.stringify(message, null, 2));\n\n    // Verify the message\n    const errMsg = PbUserPhysData.verify(message);\n    if (errMsg) {\n        console.error('Protobuf verification failed:', errMsg);\n        throw new Error(`Invalid FTU message: ${errMsg}`);\n    }\n\n    console.log('Message verified successfully');\n\n    const encoded = PbUserPhysData.encode(message).finish();\n    console.log('Encoded to', encoded.length, 'bytes:', Array.from(encoded).map(b => '0x' + b.toString(16).padStart(2, '0')).join(' '));\n\n    // Try to decode it back to verify\n    try {\n        const decoded = PbUserPhysData.decode(encoded);\n        console.log('Decode test successful:', decoded);\n    } catch (error) {\n        console.error('Decode test failed:', error);\n    }\n\n    return encoded;\n};\n\nexport const encodeUserIdentifier = (deviceTime: string): Uint8Array => {\n    if (!userIdRoot) initProtobuf();\n\n    const PbUserIdentifier = userIdRoot.lookupType('UserData.PbUserIdentifier');\n\n    const now = new Date(deviceTime);\n    const tzOffset = -now.getTimezoneOffset();\n\n    const messageData = {\n        master_identifier: '18446744073709551615', // UInt64.MAX_VALUE\n        user_id_last_modified: {\n            date: {\n                year: now.getFullYear(),\n                month: now.getMonth() + 1,\n                day: now.getDate()\n            },\n            time: {\n                hour: now.getHours(),\n                minute: now.getMinutes(),\n                second: now.getSeconds(),\n                millis: now.getMilliseconds(),\n                tz_offset: tzOffset\n            },\n            trusted: true\n        }\n    };\n\n    console.log('Creating user identifier protobuf:', messageData);\n\n    const message = PbUserIdentifier.create(messageData);\n    const encoded = PbUserIdentifier.encode(message).finish();\n\n    console.log('User identifier encoded to', encoded.length, 'bytes');\n\n    return encoded;\n};\n\nexport const encodeSetLocalTimeParams = (time: Date): Uint8Array => {\n    if (!pftpRoot) initProtobuf();\n\n    const PbPFtpSetLocalTimeParams = pftpRoot.lookupType('PftpRequest.PbPFtpSetLocalTimeParams');\n\n    const tzOffset = -time.getTimezoneOffset();\n\n    const messageData = {\n        date: {\n            year: time.getFullYear(),\n            month: time.getMonth() + 1,\n            day: time.getDate()\n        },\n        time: {\n            hour: time.getHours(),\n            minute: time.getMinutes(),\n            seconds: time.getSeconds(),\n            millis: time.getMilliseconds()\n        },\n        tz_offset: tzOffset\n    };\n\n    console.log('Creating setLocalTime params:', messageData);\n\n    const message = PbPFtpSetLocalTimeParams.create(messageData);\n    const encoded = PbPFtpSetLocalTimeParams.encode(message).finish();\n\n    console.log('SetLocalTime params encoded to', encoded.length, 'bytes');\n\n    return encoded;\n};\n\n"]}